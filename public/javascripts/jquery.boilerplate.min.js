/*
 *  jquery-boilerplate - v4.1.0
 *  A jump-start for jQuery plugins development.
 *  http://jqueryboilerplate.com
 *
 *  Made by Zeno Rocha
 *  Under MIT License
 */
!function(a){var b,c,d;return d="maxupload",c={basepath:"",url:"upload.php",formData:{},height:256,width:256,tagname:"files",photo:"img/upload-foto.png",loading:"img/loading.gif",acceptFile:"image/*",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,debug:!1,alwaysUpload:!1,autoStartWebcam:!1,ondelete:function(){},onready:function(){},onchange:function(){},onupdate:function(){},oncomplete:function(){},oninitwebcam:function(){},ondestroywebcam:function(){}},b=function(){function b(b,e){this.element=b,this.settings=a.extend({},c,e),this._defaults=c,this._getUserMedia=void 0,this._cameraStream=void 0,this._name=d,this._info=void 0,this._data=void 0,this._image=void 0,this._swap=!1,this.preload=void 0,this.canvas=void 0,this.rotate=0,this.zoom={},this.preview=void 0,this.video=void 0,this.webcam=void 0,this.holder=void 0,this.start_pos=[],this.element_pos=[],this.end_pos=[],this.draging=!1,this.prevent_scroll=!1,this.is_loading=!1,this.init()}return b.prototype.init=function(){var b;this.element=a(this.element),b='<div id="holder" class="wrapper-maxupload" style="width:'+this.settings.width+"px;height:"+this.settings.height+'px;"><img id="preview" class="preview-maxupload" src><div class="webcam-tools"><div id="left-tools"><button id="captureWebcam">capture</button><button id="cancelWebcam">cancel</button><button id="saveWebcam">save</button></div><div id="top-tools"><button id="destroyWebcam">X</button></div></div><video id="webcam" class="webcam-maxupload" preload="auto" loop="loop"></video><a href="javascript:void(0)"><img src="'+this.settings.photo+'" class="poster-maxupload"></a><div id="edit" class="edit-maxupload"><div id="left-tools"><button id="zoomin">+</button><button id="zoomout">-</button><button id="rotate">R</button><button id="toggle_scroll">T</button></div><div id="top-tools"><button id="delete">X</button><button id="submit">V</button></div><div id="bot-tools">x:<input type="text" id="x"/>px,y:<input type="text" id="y"/>px,w:<input type="text" id="w"/>px,h:<input type="text" id="h"/>px,r:<input type="text" disabled=disabled id="r"/>px</div></div><div id="filename" class="filename-maxupload"  style="width:'+this.settings.width+"px;height:"+this.settings.height+'px;"><input id="'+this.settings.tagname+'" type="file" accept="'+this.settings.acceptFile+'" name="'+this.settings.tagname+'"></div><div class="max-loading"><img src="'+this.settings.loading+'"></div><div class="preload"></div></div>',this.element.html(b),this.holder=this.element.find("#holder"),this.preload=this.element.find(".preload"),this.preview=this.element.find("#preview"),this.webcam=this.element.find("#webcam"),this.element.find("img").on("dragstart",function(a){return a.preventDefault()}),this.element.find("#delete").on("click",this._deleteEvent.bind(this)),this.element.find("#rotate").on("click",this._rotateEvent.bind(this)),this.element.find("#toggle_scroll").on("click",this._toggleScrollEvent.bind(this)),this.element.find("#zoomin").on("click",this._zoomInEvent.bind(this)),this.element.find("#zoomout").on("click",this._zoomOutEvent.bind(this)),this.element.find("#submit").on("click",this._completeEvent.bind(this)),this._getUserMedia=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(a){return new Promise(function(b,c){return(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,a,b,c)})}}:null,"undefined"!=typeof this._getUserMedia&&(this.canvas=a("<canvas>"),this.element.find("#captureWebcam").on("click",this._captureWebcamEvent.bind(this)),this.element.find("#cancelWebcam").on("click",this._cancelWebcamEvent.bind(this)),this.element.find("#saveWebcam").on("click",this._saveWebcamEvent.bind(this)),this.element.find("#destroyWebcam").on("click",this.destroyWebcam.bind(this))),"ontouchstart"in window&&this.element.find("#toggle_scroll").show(),this.settings.debug?this.element.find("#bot-tools").show():this.element.find("#bot-tools").hide(),"undefined"==typeof FileReader||this.settings.alwaysUpload?this.element.find("#"+this.settings.tagname).fileupload({url:this.settings.url,type:"POST",dataType:"json",formData:a.extend(this.settings.formData,{inputname:this.settings.tagname}),add:this._addEvent.bind(this),done:this._doneEvent.bind(this)}):this.element.find("#"+this.settings.tagname).on("change",this._showImage.bind(this)),"undefined"!=typeof this._getUserMedia&&this.settings.autoStartWebcam&&this.initWebcam(),this.settings.onready&&this.settings.onready.call(null,this)},b.prototype._addEvent=function(a,b){var c;c=[],b.originalFiles[0].type.length&&!this.settings.acceptFileTypes.test(b.originalFiles[0].type)&&c.push("Not an accepted file type"),b.originalFiles[0].size.length&&b.originalFiles[0].size>5e6&&c.push("Filesize is too big"),c.length>0?alert(c.join("\n")):(this.show_loading(),b.submit())},b.prototype._doneEvent=function(a,b){var c,d;this.settings.onchange&&this.settings.onchange.call(this,b),"undefined"!=typeof b.result[this.settings.tagname]&&(this._image=new Image,c=""!==this.settings.basepath?this.settings.basepath+"/":"",this._image.onload=this._readLoad.bind(this),this._image.src=c+b.result[this.settings.tagname][0].url,this.preload.html(""),this.preload.append(this._image)),d=!1},b.prototype._showImage=function(a){var b,c,d,e;this.settings.onchange&&this.settings.onchange.call(this),b=this,c=a.dataTransfer||a.originalEvent&&a.originalEvent.dataTransfer,d=a.target.files||c&&c.files,d.length>0&&(e=new FileReader,e.onload=function(a){return b._image=new Image,b._image.onload=b._readLoad.bind(b),b._image.src=a.target.result},e.readAsDataURL(d[0]))},b.prototype._readLoad=function(){var a,b;this.preview.css({"margin-top":"0px","margin-left":"0px"}),this.preview.css("width",""),this.preview.css("height",""),this.rotate=0,this.zoom={},this.preview.attr("src",this._image.src),this._image.width<this._image.height?(a=this.settings.width/this._image.width*this._image.height,a<this.settings.height?(this.preview.css("height",this.settings.height),b=this.settings.height/this._image.height*this._image.width,this.preview.css("width",b),this.preview.css({top:0,left:(b-this.settings.width)/2*-1}).show()):(this.preview.css("height",a),this.preview.css("width",this.settings.width),this.preview.css({left:0,top:(a-this.settings.height)/2*-1}).show())):(b=this.settings.height/this._image.height*this._image.width,b<this.settings.width?(this.preview.css("width",this.settings.width),a=this.settings.width/this._image.width*this._image.height,this.preview.css("height",a),this.preview.css({left:0,top:(a-this.settings.height)/2*-1}).show()):(this.preview.css("height",this.settings.height),this.preview.css("width",b),this.preview.css({top:0,left:(b-this.settings.width)/2*-1}).show())),this._show_edit_tools(),this._adjust_img(),this.holder.trigger("mouseenter"),this.element.find("#filename").hide(),this.hide_loading(),this.element.find(".poster-maxupload").hide(),this.settings.onupdate&&this.settings.onupdate.call(null,this)},b.prototype.initWebcam=function(){var a;if(a=this,"undefined"!=typeof this._getUserMedia)return this._getUserMedia.getUserMedia({video:!0}).then(function(a){return this._cameraStream=a,this.webcam.get(0).onloadedmetadata=function(){var a;return this.webcam.show(),this.element.find(".poster-maxupload").hide(),this.element.find("#filename").hide(),this.element.find(".webcam-tools").show(),this.element.find(".webcam-tools #captureWebcam").show(),this.element.find(".webcam-tools #cancelWebcam,.webcam-tools #saveWebcam").hide(),this.webcam.get(0).play(),a=this._calculateAspectRatioFit(this.webcam.width(),this.webcam.height(),this.settings.width,this.settings.height),this.webcam.attr({width:a.width,height:a.height}),a.width===this.settings.width?this.webcam.css("margin-top",(this.settings.height-a.height)/2):this.webcam.css("margin-left",(this.settings.width-a.width)/2),this.settings.oninitwebcam&&this.settings.oninitwebcam.call(null,this)}.bind(this),this.webcam.get(0).src=window.URL.createObjectURL(a)||a}.bind(this)).catch(function(){return console.log("MAXUPLOAD: error while start init webcam, maybe other browser is using same webcam.")})},b.prototype.destroyWebcam=function(){var a;if("undefined"!=typeof this._getUserMedia)return this._cameraStream&&(this._cameraStream.getVideoTracks?(a=this._cameraStream.getVideoTracks(),a&&a[0]&&a[0].stop&&a[0].stop()):this._cameraStream.stop&&this._cameraStream.stop()),delete this.stream,delete this.video,this.webcam.mozCaptureStream?this.webcam.mozSrcObject=null:this.webcam.src="",this.webcam.hide(),this.element.find(".webcam-tools").hide(),this.element.find("#filename").show(),this.element.find(".poster-maxupload").show(),this.settings.ondestroywebcam&&this.settings.ondestroywebcam.call(null,this)},b.prototype._captureWebcamEvent=function(){return this.webcam.get(0).pause(),this.element.find(".webcam-tools #captureWebcam").hide(),this.element.find(".webcam-tools #cancelWebcam,.webcam-tools #saveWebcam").show()},b.prototype._cancelWebcamEvent=function(){return this.webcam.get(0).play(),this.element.find(".webcam-tools #captureWebcam").show(),this.element.find(".webcam-tools #cancelWebcam,.webcam-tools #saveWebcam").hide()},b.prototype._saveWebcamEvent=function(){var a,b,c,d,e;return this.canvas.attr("width",this.webcam[0].videoWidth),this.canvas.attr("height",this.webcam[0].videoHeight),b=this.canvas.get(0).getContext("2d"),b.drawImage(this.webcam.get(0),0,0,this.webcam[0].videoWidth,this.webcam[0].videoHeight),console.log(this.settings.alwaysUpload),this.settings.alwaysUpload?(e=b.canvas.toDataURL("image/jpeg"),a=this.dataURItoBlob(e),c=new FormData,d=new File([a],"webcam-"+(new Date).getTime()/1e3+".jpg",{type:"image/jpeg"}),c.append("image",d),this.element.find("#"+this.settings.tagname).on("fileuploaddone",function(a,b){return"undefined"!=typeof b.result[this.settings.tagname]&&(this._image=new Image),this._image.onload=this._readLoad.bind(this),this._image.src=this.canvas.get(0).toDataURL("image/jpeg",1),this.webcam.hide(),this.element.find(".webcam-tools").hide()}.bind(this)),this.element.find("#"+this.settings.tagname).fileupload("add",{files:d})):(this._image=new Image,this._image.onload=this._readLoad.bind(this),this._image.src=this.canvas.get(0).toDataURL("image/jpeg",1),this.webcam.hide(),this.element.find(".webcam-tools").hide())},b.prototype._show_edit_tools=function(){this.holder.on({mouseenter:this._startEvent.bind(this),touchstart:this._startEvent.bind(this),touchend:this._endEvent.bind(this),mouseleave:this._endEvent.bind(this)}),this._info=this.holder.find("#bot-tools"),this._info.find("input").on("change",function(){switch(a(this).attr("id")){case"x":return this.preview.css("left",parseFloat(a(this).val())+"px");case"y":return this.preview.css("top",parseFloat(a(this).val())+"px");case"w":return this.preview.css("width",parseFloat(a(this).val())+"px");case"h":return this.preview.css("height",parseFloat(a(this).val())+"px")}}).on("click",function(){return this.setSelectionRange(0,this.value.length),this.updateInfo()})},b.prototype._startEvent=function(){this.holder.data("time_fade")&&clearTimeout(this.holder.data("time_fade")),this.element.find("#edit").show(),this.holder.find("#left-tools").stop().animate({left:"0px"},200),this.holder.find("#top-tools").stop().animate({top:"0px"},200),this.holder.find("#bot-tools").stop().animate({bottom:"0px"},200)},b.prototype._timeoutEndEvent=function(){this.holder.find("#left-tools").stop().animate({left:"-"+this.holder.find("#left-tools").width()},200),this.holder.find("#top-tools").stop().animate({top:"-40px"},200),this.holder.find("#bot-tools").stop().animate({bottom:"-40px"},200)},b.prototype._endEvent=function(){this.holder.data("time_fade",setTimeout(this._timeoutEndEvent.bind(this),3e3))},b.prototype._adjust_img=function(){this.draging=!1,this.preview.on({mousedown:this._mouseStartEvent.bind(this),touchstart:this._touchStartEvent.bind(this),mousemove:this._mouseMoveEvent.bind(this),touchmove:this._touchMoveEvent.bind(this),mouseup:this._endDragingEvent.bind(this),touchend:this._endDragingEvent.bind(this),mouseleave:this._endDragingEvent.bind(this)})},b.prototype._mouseStartEvent=function(a){this.start_pos=[a.pageX,a.pageY],this.element_pos=[parseFloat(this.preview.css("left")),parseFloat(this.preview.css("top"))],this.draging=!0},b.prototype._touchStartEvent=function(a){var b;this.prevent_scroll&&(a.preventDefault(),b=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],this.start_pos=[b.pageX,b.pageY],this.element_pos=[parseFloat(this.preview.css("left")),parseFloat(this.preview.css("top"))],this.draging=!0)},b.prototype._mouseMoveEvent=function(a){this.draging&&(this.end_pos=[a.pageX,a.pageY],(this.end_pos[0]-this.start_pos[0]>50||this.end_pos[0]-this.start_pos[0]<50||this.end_pos[1]-this.start_pos[1]>50||this.end_pos[1]-this.start_pos[1]<50)&&this._moveEvent(),this.updateInfo())},b.prototype._touchMoveEvent=function(a){var b;this.draging&&(b=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],this.end_pos=[b.pageX,b.pageY],(this.end_pos[0]-this.start_pos[0]>50||this.end_pos[0]-this.start_pos[0]<50||this.end_pos[1]-this.start_pos[1]>50||this.end_pos[1]-this.start_pos[1]<50)&&this._moveEvent(),this.updateInfo())},b.prototype._moveEvent=function(){var a,b,c,d;return b=this.element_pos[0]+this.end_pos[0]-this.start_pos[0],c=this.element_pos[1]+this.end_pos[1]-this.start_pos[1],d=parseFloat(this.preview.width())-parseFloat(this.holder.width()),a=parseFloat(this.preview.height())-parseFloat(this.holder.height()),this.preview.css({left:b>0?0:b<d*-1?d*-1:b,top:c>0?0:c<a*-1?a*-1:c})},b.prototype._endDragingEvent=function(){this.draging=!1},b.prototype.show_loading=function(){this.is_loading||(this.element.find(".max-loading").show(),this.is_loading=!0)},b.prototype.hide_loading=function(){this.is_loading=!1,this.element.find(".max-loading").hide()},b.prototype._deleteEvent=function(a){return a.preventDefault(),this.holder.off("mouseenter").off("mouseleave").off("touchstart").off("touchend"),this.preview.attr("src",""),this.preview.css("width","0px"),this.preview.css("height","0px"),this.rotate=0,this.zoom={},this.preview.removeClass("rotate90 rotate180 rotate270"),this.element.find("#"+this.settings.tagname).val(""),this.element.find("#filename").show(),this.element.find("#edit").hide(),this.element.find(".poster-maxupload").show(),"undefined"!=typeof this._getUserMedia&&this.settings.autoStartWebcam&&this.initWebcam(),this.settings.ondelete&&this.settings.ondelete.call(this),!1},b.prototype._rotateEvent=function(a){var b,c;return a.preventDefault(),this.rotate=this.rotate+90>=360?0:this.rotate+90,this.preview.removeClass("rotate90 rotate180 rotate270"),b=this.preview.width(),c=this.preview.height(),this.preview.addClass("rotate"+this.rotate),this.preview.width()===c&&this.preview.height()===b&&(this._swap=!0),this.start_pos=[0,0],this.element_pos=[parseFloat(this.preview.css("left")),parseFloat(this.preview.css("top"))],this.end_pos=[0,0],this._moveEvent(),this._zoomOutEvent(),this.updateInfo(),!1},b.prototype._zoomInEvent=function(a){var b,c;return a.preventDefault(),this.rotate%180!==0&&this._swap?(b=[parseFloat(this.holder.height()),parseFloat(this.holder.width())],c=[parseFloat(this.preview.height()),parseFloat(this.preview.width())]):(b=[parseFloat(this.holder.width()),parseFloat(this.holder.height())],c=[parseFloat(this.preview.width()),parseFloat(this.preview.height())]),this.zoom.w=c[0]+5*c[0]/100,this.zoom.h=c[1]+5*c[1]/100,this.preview.css("height",this.zoom.h),this.preview.css("width",this.zoom.w),this.updateInfo(),!1},b.prototype._zoomOutEvent=function(a){var b,c,d,e,f,g;return"undefined"!=typeof a&&a.preventDefault(),f=[parseFloat(this.holder.width()),parseFloat(this.holder.height())],g=[parseFloat(this.preview.width()),parseFloat(this.preview.height())],this.rotate%180!==0&&(f=[parseFloat(this.holder.height()),parseFloat(this.holder.width())],g=[parseFloat(this.preview.height()),parseFloat(this.preview.width())]),this.zoom.w=g[0]-5*g[0]/100,this.zoom.h=g[1]-5*g[1]/100,(this.zoom.w<f[0]||this.zoom.h<f[1])&&(g[0]<g[1]?(b=f[0]/g[0]*g[1],b<f[1]?(this.zoom.h=f[1],e=f[1]/g[1]*g[0],this.zoom.w=e):(this.zoom.h=b,this.zoom.w=f[0])):(e=f[1]/g[1]*g[0],e<f[0]?(this.zoom.w=f[0],b=f[0]/g[0]*g[1],this.zoom.h=b):(this.zoom.h=f[1],this.zoom.w=e))),this.preview.css("height",this.zoom.h),this.preview.css("width",this.zoom.w),c=parseFloat(this.preview.css("left")),d=parseFloat(this.preview.css("top")),e=this.zoom.w-f[0],b=this.zoom.h-f[1],this.preview.css({left:c>0?0:c<e*-1?e*-1:c,top:d>0?0:d<b*-1?b*-1:d}),this.updateInfo(),!1},b.prototype._toggleScrollEvent=function(b){return b.preventDefault(),a(b.target).hasClass("active")?(this.prevent_scroll=!1,a(b.target).removeClass("active")):(this.prevent_scroll=!0,a(b.target).addClass("active"))},b.prototype._completeEvent=function(a){return a.preventDefault(),this.settings.oncomplete&&this.settings.oncomplete.call(this,{x:this.preview.css("left"),y:this.preview.css("top"),w:this.preview.css("width"),h:this.preview.css("height")}),!1},b.prototype.reset=function(){return _deleteEvent()},b.prototype.updateInfo=function(){this._info&&(this._info.find("#x").val(parseFloat(a(this.preview).css("left"))),this._info.find("#y").val(parseFloat(a(this.preview).css("top"))),this._info.find("#w").val(parseFloat(a(this.preview).css("width"))),this._info.find("#h").val(parseFloat(a(this.preview).css("height"))),this._info.find("#r").val(parseFloat(this.rotate))),this.settings.update&&this.settings.update.call(null,this)},b.prototype.getData=function(){var b,c,d,e,f,g,h,i;return h=-parseFloat(a(this.preview).css("left")),i=-parseFloat(a(this.preview).css("top")),g=parseFloat(a(this.preview).css("width")),d=parseFloat(a(this.preview).css("height")),f=this._image.width/g,e=this._image.height/d,c=parseFloat(this.holder.css("width")),b=parseFloat(this.holder.css("height")),{position:{x:a(this.preview).css("left"),y:a(this.preview).css("top"),w:a(this.preview).css("width"),h:a(this.preview).css("height"),frame:{w:c,h:b}},normalized:{x:h*f,y:i*e,w:c*f,h:b*e,frame:{w:c,h:b}}}},b.prototype._calculateAspectRatioFit=function(a,b,c,d){var e;return e=Math.max(c/a,d/b),{width:a*e,height:b*e}},b.prototype.dataURItoBlob=function(a){var b,c,d,e;for(b=void 0,b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]),e=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),c=0;c<b.length;)d[c]=b.charCodeAt(c),c++;return new Blob([d],{type:e})},b}(),a.fn[d]=function(c){return this.each(function(){if(!a.data(this,"plugin_"+d))return a.data(this,"plugin_"+d,new b(this,c))})}}(jQuery);